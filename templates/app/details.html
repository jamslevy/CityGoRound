{% extends 'base.html' %}

{% block headscripts %}
<script src="http://cdn.jquerytools.org/1.1.2/full/jquery.tools.min.js"></script>
<link rel="stylesheet" type="text/css" href="/css/jquery.rating.css" media="screen" />
<script type="text/javascript" src="/js/jquery.rating.pack.js"></script>
{% endblock %}

{% block extra_head %}

    <script type="text/javascript">
    
    function react_to_vote( data ) {
      average_rating = data[0];
      num_ratings = data[1];
    
      $("#ratings").html("average "+average_rating+"/5 over "+num_ratings+" votes");
    }
    
     $(document).ready(function(){
     
       $('.auto-submit-star').rating({ 
         callback: function(value, link){
                     $.getJSON( "/admin/apps/rating/", {'app_key_id':'{{transit_app.key.id}}','rating':value}, react_to_vote );
                     document.cookie ='{{transit_app.key.id}}='+value+'; expires=Thu, 2 Aug 2010 20:47:11 UTC; path=/';
                   } 
       });
     
     });

    </script>

{% endblock %}

{% block title %}Open Transit Data &raquo; Details For {{transit_app.title}}{% endblock %}

{% block content %}
    
<div id="app-details" class="body-content col-group">    
    <h2>{{transit_app.title}} <span>By {{transit_app.author_name}}</span></h2>
    <p>{{transit_app.description}}</p>
    <div class="app-images" id="triggers">
        <a href="{% screen_shot_image_url transit_app default original %}" title="{{transit_app.title}} screenshot"><img src="{{transit_app.default_300w_screen_shot_url}}" alt="Application Screen Shot" /></a>
        <label>Additional Images:</label>
        <div class="app-images-thumbs">
            {% for i in transit_app.screen_shot_non_default_indexes %}
                <a href="{% screen_shot_image_url transit_app i original %}" title="{{transit_app.title}} screenshot"><img src="{% screen_shot_image_url transit_app i 145w %}" alt="Application Screen Shot" /></a>
            {% endfor %}
        </div>

    </div>
    
    <div class="app-info">
        <div id="app-details" class="body-content">    
        <label>Ratings:</label> <div><p id="ratings">average {{transit_app.average_rating}}/5 over {{transit_app.num_ratings}} votes</p></div>
        <div id="votebooth">
        <form name="rating" action="/app/rating" method="POST">
        <p>Your rating:
        <input type="radio" name="rating" value="1" onchange="vote(this.value);" class="auto-submit-star">
        <input type="radio" name="rating" value="2" onchange="vote(this.value);" class="auto-submit-star">
        <input type="radio" name="rating" value="3" onchange="vote(this.value);" class="auto-submit-star">
        <input type="radio" name="rating" value="4" onchange="vote(this.value);" class="auto-submit-star">
        <input type="radio" name="rating" value="5" onchange="vote(this.value);" class="auto-submit-star">
        </p></form>
        </div>
    </div>

        <label>Full Description:</label> <p>{{transit_app.long_description}}"</p>
        <p><a href="{{transit_app.url}}">Visit developer's website</a></p>
        {% if transit_app.categories %}
            <div>
                <label>Categories:</label> <p>{% for i in transit_app.categories %}{% if not forloop.first %}, {% endif %}{{ i }}{% endfor %}<p>
            </div>
        {% endif %}
        {% if transit_app.platforms %}
            <div>
                <label>Platforms:</label> <p>{% for i in transit_app.platforms %}{% if not forloop.first %}, {% endif %}{{ i }}{% endfor %}<p>
            </div>
        {% endif %}
        {% if transit_app.tags %}
            <div>
                <label>All tags:</label> <p>{% for i in transit_app.tags %}{% if not forloop.first %}, {% endif %}{{ i }}{% endfor %}<p>
            </div>
        {% endif %}
        {% if locations %}
            <div>
                <label>Areas Supported:</label> <p>{% for i in locations %}<li>{{ i }}</li>{% endfor %}<p>
            </div>
        {% endif %}
        {% if agencies %}
            <div class="condensed-agency-list">
                <label>Uses Open Data from:</label> <ul>{% for i in agencies %}<li><a href="/agencies/{{ i.urlslug }}">{{ i.name }}</a> {{ i.city }}, {{ i.state}}</li>{% endfor %}</ul>
            </div>
        {% endif %}
    </div>
</div>
<div class="wide-col rightmost">
	{% include "includes/mrec1.html" %}
</div>
{% endblock %}


{% block extra-content %}
<!-- gallery overlay element --> 
<div class="simple_overlay" id="gallery"> 
     <!-- "previous image" action --> 
    <a class="prev">prev</a> 
    <!-- "next image" action --> 
    <a class="next">next</a> 
    <!-- image information --> 
    <div class="info"></div> 
    <!-- load indicator (animated gif) --> 
    <img class="progress" src="http://static.flowplayer.org/tools/img/overlay/loading.gif" /> 
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
// select the thumbnails and make them trigger our overlay 
$("#triggers a").overlay({ 
 
    // each trigger uses the same overlay with the id "gallery" 
    target: '#gallery', 
 
    // optional exposing effect 
    expose: '#f1f1f1' 
 
// let the gallery plugin do its magic! 
}).gallery({ 
 
    // the plugin accepts its own set of configuration options 
    speed: 800 
});
</script>
{% endblock %}
